deliveriesRoot:
  post:
    tags:
      - Deliveries
    summary: Start Delivery
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required: [order_id, courier_id]
            properties:
              order_id: { type: integer, example: 101 }
              courier_id: { type: integer, example: 5 }
    responses:
      "201":
        description: Delivery Created Successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
                  example: "Delivery started"
                # --- PERBAIKAN: Harus ada 'data' dulu, baru $ref di bawahnya ---
                data:
                  $ref: "../components/schemas.yaml#/DeliveryInfo"

            # --- PERBAIKAN EXAMPLE: Harus mengikuti struktur (message + data) ---
            example:
              message: "Delivery started"
              data: # <--- Jangan lupa pembungkus ini di example juga
                id: 55
                courier_id: 5
                courier_name: "Ujang Kurir"
                picked_at: "2025-12-22T12:07:14Z"
                delivered_at: null # <--- BERHASIL TAMPIL NULL
                cod_collected_amount: 0

      "400":
        description: Validation Error (Business Logic)
        content:
          application/json:
            schema:
              # KITA PANGGIL CETAKAN ERROR RESPONSE DISINI
              $ref: "../components/schemas.yaml#/ErrorResponse"
            example:
              error:
                code: "business_logic_error"
                message: "Order is not ready for delivery OR Order is already taken"

      "401":
        $ref: "../components/responses.yaml#/UnauthorizedError"

      "404":
        description: Order Not Found
        content:
          application/json:
            schema:
              $ref: "../components/schemas.yaml#/ErrorResponse"
            example:
              error:
                code: "not_found"
                message: "Order ID 101 not found"

      "500":
        $ref: "../components/responses.yaml#/InternalServerError"

deliveriesId:
  patch:
    tags:
      - Deliveries
    summary: Finish Delivery
    security:
      - bearerAuth: []
    parameters:
      - name: id
        in: path
        required: true
        schema: { type: integer }
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required: [status]
            properties:
              status: { type: string, enum: ["delivered"] }
              cod_collected_amount: { type: integer, default: 0 }
    responses:
      "200":
        description: Delivery Finished
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
                  example: "Delivery completed"
                data:
                  $ref: "../components/schemas.yaml#/DeliveryInfo"

      "401":
        $ref: "../components/responses.yaml#/UnauthorizedError"

      "403":
        $ref: "../components/responses.yaml#/ForbiddenError"

      "404":
        description: Delivery Not Found
        content:
          application/json:
            schema:
              $ref: "../components/schemas.yaml#/ErrorResponse"
            example:
              error:
                code: "not_found"
                message: "Delivery ID not found"

      "500":
        $ref: "../components/responses.yaml#/InternalServerError"
